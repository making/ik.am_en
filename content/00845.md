---
title: Notes on Separating the Database Used in Jobs and the Database Managing Jobs with Spring Batch + Spring Boot
tags: ["Spring Batch", "Spring Boot", "Java", "Spring"]
categories: ["Programming", "Java", "org", "springframework", "batch"]
date: 2025-04-08T15:43:22Z
updated: 2025-04-08T15:46Z
---

> ⚠️ This article was automatically translated by OpenAI (gpt-4o-mini).
> It may be edited eventually, but please be aware that it may contain incorrect information at this time.

The method to separate the database used in jobs from the database managing jobs in Spring Batch is described in the [Spring Boot documentation](https://docs.spring.io/spring-boot/docs/current/reference/html/howto.html#howto.batch.specifying-a-data-source), but since there are no implementation examples, I will note it down.

I have confirmed it works with Spring Boot 3.4 and Spring Batch 5.2.

You can prepare a configuration class like the following.

```java
package com.example.batch;

import com.zaxxer.hikari.HikariDataSource;
import javax.sql.DataSource;
import org.springframework.beans.factory.annotation.Qualifier;
import org.springframework.boot.autoconfigure.batch.BatchDataSource;
import org.springframework.boot.autoconfigure.batch.BatchTransactionManager;
import org.springframework.boot.autoconfigure.condition.ConditionalOnProperty;
import org.springframework.boot.autoconfigure.jdbc.DataSourceProperties;
import org.springframework.boot.context.properties.ConfigurationProperties;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.jdbc.support.JdbcTransactionManager;
import org.springframework.transaction.PlatformTransactionManager;

@Configuration(proxyBeanMethods = false)
@ConditionalOnProperty(name = "spring.batch.datasource.url")
public class DataSourceConfig {

	@Bean
	@ConfigurationProperties("spring.datasource")
	public DataSourceProperties defaultDataSourceProperties() {
		return new DataSourceProperties();
	}

	@Bean
	@ConfigurationProperties("spring.datasource.hikari")
	public HikariDataSource defaultDataSource(
			@Qualifier("defaultDataSourceProperties") DataSourceProperties properties) {
		HikariDataSource dataSource = properties.initializeDataSourceBuilder().type(HikariDataSource.class).build();
		dataSource.setPoolName("default-pool");
		return dataSource;
	}

	@Bean
	@ConfigurationProperties("spring.batch.datasource")
	public DataSourceProperties batchDataSourceProperties() {
		return new DataSourceProperties();
	}

	@BatchDataSource
	@Bean(defaultCandidate = false)
	@ConfigurationProperties("spring.batch.datasource.hikari")
	public HikariDataSource batchDataSource(@Qualifier("batchDataSourceProperties") DataSourceProperties properties) {
		HikariDataSource dataSource = properties.initializeDataSourceBuilder().type(HikariDataSource.class).build();
		dataSource.setPoolName("batch-pool");
		return dataSource;
	}

	@BatchTransactionManager
	@Bean(defaultCandidate = false)
	public PlatformTransactionManager batchTransactionManager(@BatchDataSource DataSource dataSource) {
		return new JdbcTransactionManager(dataSource);
	}

}
```

By adding `@Bean(defaultCandidate = false)`, the bean will not be eligible for injection unless explicitly specified with `@Qualifier` (including `@BatchDataSource` and `@BatchTransactionManager`). In Spring Boot's Auto Configuration, when creating `JobRepository` and `JobExplorer`, it will use the bean definitions annotated with `@BatchDataSource` or `@BatchTransactionManager` if they exist.

An example of property settings is as follows.

```properties
spring.datasource.driver-class-name=org.postgresql.Driver
spring.datasource.url=jdbc:postgresql://localhost:5432/mydatabase
spring.datasource.username=myuser
spring.datasource.password=secret
spring.batch.datasource.driver-class-name=org.postgresql.Driver
spring.batch.datasource.url=jdbc:postgresql://localhost:15432/spring_batch
spring.batch.datasource.username=spring_batch
spring.batch.datasource.password=admin
```

Set the database used in jobs with `spring.datasource.*`. This uses the same properties as the usual database settings. Set the database managing jobs with `spring.batch.datasource.*`. Since it has `@ConditionalOnProperty(name = "spring.batch.datasource.url")`, the above config will only be effective when the database settings for managing jobs are explicitly defined with `spring.batch.datasource.url`. If `spring.batch.datasource.url` is not specified, it will remain as the default Auto Configuration.

In this example, both the database used in jobs and the database managing jobs are using PostgreSQL, but you can use a different database as well. For example, with the following definition, you can use an in-memory H2 database for the database managing jobs.

```properties
spring.batch.datasource.url=jdbc:h2:mem:spring_batch
spring.batch.datasource.driverClassName=org.h2.Driver
spring.batch.datasource.username=sa
spring.batch.datasource.password=
```
